<section class="breakdown-section">
  <header class="breakdown-header">
    <div>
      <h2>Category Breakdown</h2>
      <p>See where your money is going for the selected period.</p>
    </div>
  </header>

  <div *ngIf="error" class="alert error">{{ error }}</div>

  <div *ngIf="loading" class="loading-state">
    <div class="spinner" aria-hidden="true"></div>
    <span>Loading category breakdown...</span>
  </div>

  <div *ngIf="!loading && !error">
    <div class="breakdown-grid" *ngIf="hasData; else emptyState">
      <article class="breakdown-card">
        <div class="card-header income">
          <h3>Income Categories</h3>
        </div>
        <table>
          <thead>
            <tr>
              <th>Category</th>
              <th>Amount</th>
              <th>Share</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let category of incomeCategories; trackBy: trackByCategory">
              <td>
                <p class="category-name">{{ category.categoryName }}</p>
                <p class="transaction-count">{{ category.transactionCount }} transactions</p>
              </td>
              <td class="amount">{{ category.totalAmount | currency }}</td>
              <td class="percentage-cell">
                <div class="progress-bar">
                  <div class="progress income" [style.width.%]="category.percentage"></div>
                </div>
                <span>{{ category.percentage | number: '1.0-1' }}%</span>
              </td>
              <td class="action-cell">
                <button (click)="viewTransactions(category)">View</button>
              </td>
            </tr>
          </tbody>
        </table>
      </article>

      <article class="breakdown-card">
        <div class="card-header expense">
          <h3>Expense Categories</h3>
        </div>
        <table>
          <thead>
            <tr>
              <th>Category</th>
              <th>Amount</th>
              <th>Share</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let category of expenseCategories; trackBy: trackByCategory">
              <td>
                <p class="category-name">{{ category.categoryName }}</p>
                <p class="transaction-count">{{ category.transactionCount }} transactions</p>
              </td>
              <td class="amount">{{ category.totalAmount | currency }}</td>
              <td class="percentage-cell">
                <div class="progress-bar">
                  <div class="progress expense" [style.width.%]="category.percentage"></div>
                </div>
                <span>{{ category.percentage | number: '1.0-1' }}%</span>
              </td>
              <td class="action-cell">
                <button (click)="viewTransactions(category)">View</button>
              </td>
            </tr>
          </tbody>
        </table>
      </article>
    </div>

    <ng-template #emptyState>
      <div class="empty-state">
        <h4>No category data available</h4>
        <p>Add transactions to see category insights for this period.</p>
      </div>
    </ng-template>
  </div>
</section>
