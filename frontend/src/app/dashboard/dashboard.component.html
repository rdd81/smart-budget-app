<div class="dashboard-shell">
  <header class="dashboard-header">
    <div>
      <p class="welcome-text">Welcome back,</p>
      <h1 class="user-name">{{ currentUser?.email || 'Guest User' }}</h1>
    </div>
    <button class="logout-button" (click)="onLogout()">Log out</button>
  </header>

  <section class="dashboard-content">
    <div class="filter-card">
      <div class="filter-header">
        <div>
          <p class="filter-title">Monthly summary</p>
          <p class="filter-subtitle">Select a month or custom range to refresh insights.</p>
        </div>
        <select
          class="select-control"
          [ngModel]="selectedMonthKey"
          (ngModelChange)="onMonthChange($event)"
        >
          <option *ngFor="let option of monthOptions" [value]="option.key">
            {{ option.label }}
          </option>
        </select>
      </div>

      <div *ngIf="isCustomRange" class="custom-range">
        <div class="range-inputs">
          <label>
            Start date
            <input type="date" [(ngModel)]="customRange.start" />
          </label>
          <label>
            End date
            <input type="date" [(ngModel)]="customRange.end" />
          </label>
        </div>
        <button class="ghost-button" (click)="applyCustomRange()">Apply Range</button>
      </div>
    </div>

    <div *ngIf="error" class="alert error">
      <div>
        {{ error }}
      </div>
      <button class="ghost-button" (click)="selectedMonthKey === 'custom' ? applyCustomRange() : onMonthChange(selectedMonthKey)">
        Retry
      </button>
    </div>

    <div *ngIf="loading" class="card-grid">
      <div class="summary-card skeleton" *ngFor="let _ of [1,2,3]">
        <div class="skeleton-bar large"></div>
        <div class="skeleton-bar small"></div>
      </div>
    </div>

    <div *ngIf="!loading && !error">
      <div class="card-grid" *ngIf="summary && summary.transactionCount > 0">
        <div class="summary-card income-card">
          <div class="card-icon icon-income">
            <span>↑</span>
          </div>
          <div>
            <p class="card-label">Income</p>
            <p class="card-value">{{ formatCurrency(summary?.totalIncome) }}</p>
          </div>
        </div>

        <div class="summary-card expense-card">
          <div class="card-icon icon-expense">
            <span>↓</span>
          </div>
          <div>
            <p class="card-label">Expenses</p>
            <p class="card-value">{{ formatCurrency(summary?.totalExpenses) }}</p>
          </div>
        </div>

        <div class="summary-card balance-card" [ngClass]="balanceClass">
          <div class="card-icon icon-balance">
            <span>Σ</span>
          </div>
          <div>
            <p class="card-label">Balance</p>
            <p class="card-value">{{ formatCurrency(summary?.balance) }}</p>
          </div>
        </div>
      </div>

      <div *ngIf="isEmpty" class="empty-state">
        <h3>No transactions yet</h3>
        <p>Add transactions for the selected period to see insights.</p>
      </div>

      <p *ngIf="summary && summary.transactionCount > 0" class="date-range">
        Showing data for:
        <strong>
          {{ summary.startDate | date: 'MMM d, y' }} -
          {{ summary.endDate | date: 'MMM d, y' }}
        </strong>
      </p>
    </div>

    <div class="grid-layout" *ngIf="summary">
      <app-category-breakdown
        [startDate]="summary.startDate"
        [endDate]="summary.endDate"
      ></app-category-breakdown>

      <app-expense-pie-chart
        [startDate]="summary.startDate"
        [endDate]="summary.endDate"
      ></app-expense-pie-chart>

      <app-spending-trends-chart
        [startDate]="summary.startDate"
        [endDate]="summary.endDate"
      ></app-spending-trends-chart>
    </div>
  </section>
</div>
